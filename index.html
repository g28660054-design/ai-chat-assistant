<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLAZMA OS</title>
    <style>
        :root {
            --dark: #050505;
            --lava: linear-gradient(135deg, #ff4e00, #ff8c00, #ff0000);
            --orange: #ff5f00;
            --glow: 0 0 20px rgba(255, 95, 0, 0.4);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--dark); margin: 0; color: white;
            font-family: 'Segoe UI', Roboto, sans-serif; height: 100vh; display: flex; flex-direction: column;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: rgba(15, 15, 15, 0.95);
            border-bottom: 2px solid var(--orange); box-shadow: var(--glow);
        }
        .top-bar .logo { font-weight: 900; letter-spacing: 3px; color: var(--orange); text-shadow: var(--glow); }
        .nav-icons { display: flex; gap: 15px; }
        .nav-btn { background: none; border: 1px solid #333; color: var(--orange); padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 14px; }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞ */
        .chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; background: radial-gradient(circle at center, #150a00 0%, #050505 100%); }

        .msg-block { display: flex; flex-direction: column; max-width: 85%; }
        .msg-block.user { align-self: flex-end; }
        .msg-block.bot { align-self: flex-start; }

        .bubble { 
            padding: 12px 18px; border-radius: 15px; font-size: 16px; line-height: 1.5; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); position: relative;
        }
        .user .bubble { background: #222; border: 1px solid #444; color: #ddd; border-bottom-right-radius: 2px; }
        .bot .bubble { 
            background: rgba(20, 10, 0, 0.9); border: 1px solid var(--orange); border-bottom-left-radius: 2px;
            background: var(--lava); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 600;
        }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º */
        .bot-meta { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
        .avatar {
            width: 35px; height: 35px; border-radius: 50%;
            background: var(--lava); border: 2px solid var(--orange);
            box-shadow: var(--glow); transition: 0.3s;
        }
        .thinking .avatar { animation: burn 0.8s infinite alternate; }
        @keyframes burn { from { transform: scale(1); filter: hue-rotate(0deg); } to { transform: scale(1.2); filter: hue-rotate(45deg); } }

        /* –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ */
        .input-wrapper {
            padding: 20px; background: #0f0f0f; border-top: 1px solid #222;
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
        }
        .input-box {
            display: flex; gap: 10px; background: #1a1a1a; border-radius: 30px;
            padding: 5px 15px; border: 1px solid #333; align-items: center;
        }
        input { 
            flex: 1; background: none; border: none; color: white; height: 45px; 
            font-size: 16px; outline: none; 
        }
        .action-btn { 
            background: none; border: none; cursor: pointer; font-size: 22px; 
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .btn-send { color: var(--orange); }
        .btn-mic { color: #888; }
        .btn-mic.active { color: #ff0000; text-shadow: 0 0 10px red; }

        pre { background: #000; padding: 10px; border-radius: 5px; color: #ff8c00; font-size: 13px; overflow-x: auto; }
    </style>
</head>
<body>

<div class="top-bar">
    <div class="logo">PLAZMA OS</div>
    <div class="nav-icons">
        <button class="nav-btn" onclick="location.reload()">–ù–æ–≤—ã–π</button>
        <button class="nav-btn">–ß–∞—Ç—ã</button>
        <button class="nav-btn">‚öôÔ∏è</button>
    </div>
</div>

<div class="chat-container" id="chat"></div>

<div class="input-wrapper">
    <div class="input-box">
        <button id="micBtn" class="action-btn btn-mic">üé§</button>
        <input type="text" id="userInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Plazma...">
        <button id="sendBtn" class="action-btn btn-send">üöÄ</button>
    </div>
</div>

<script>
    const chatEl = document.getElementById('chat');
    const inputEl = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const micBtn = document.getElementById('micBtn');

    const API_KEY = 'AIzaSyAPAPolrbv3TtYSO27MQG-bEMK0DxDE1Ns'; 
    const URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

    let history = [];

    // –ì–æ–ª–æ—Å–æ–≤–æ–π –≤—ã–≤–æ–¥ (Voice Chat)
    function speak(text) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ru-RU';
        utterance.pitch = 0.6; // –ù–∏–∑–∫–∏–π –º—É–∂—Å–∫–æ–π –≥–æ–ª–æ—Å
        utterance.rate = 1.0;
        window.speechSynthesis.speak(utterance);
    }

    // –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const rec = new SpeechRecognition();
        rec.lang = 'ru-RU';
        micBtn.onclick = () => { rec.start(); micBtn.classList.add('active'); };
        rec.onresult = (e) => { inputEl.value = e.results[0][0].transcript; sendMessage(); };
        rec.onend = () => micBtn.classList.remove('active');
    }

    async function sendMessage() {
        const text = inputEl.value.trim();
        if (!text) return;

        addMessage(text, 'user');
        inputEl.value = '';
        
        const thinkingId = addThinking();
        history.push({ "role": "user", "parts": [{ "text": text }] });

        try {
            const response = await fetch(URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ "contents": history })
            });

            const data = await response.json();
            const botText = data.candidates[0].content.parts[0].text;

            document.getElementById(thinkingId).remove();
            addMessage(botText, 'bot');
            speak(botText);
            history.push({ "role": "model", "parts": [{ "text": botText }] });

        } catch (e) {
            if (document.getElementById(thinkingId)) document.getElementById(thinkingId).remove();
            addMessage("–û–®–ò–ë–ö–ê –Ø–î–†–ê. –ü–†–û–í–ï–†–¨–¢–ï VPN (Google API –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –†–§).", 'bot');
        }
    }

    function addMessage(text, side) {
        const block = document.createElement('div');
        block.className = `msg-block ${side}`;
        
        let content = text.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
        
        block.innerHTML = `
            <div class="bubble">${content}</div>
            ${side === 'bot' ? '<div class="bot-meta"><div class="avatar"></div><span style="font-size:10px; color:#555">PLAZMA v1.5</span></div>' : ''}
        `;
        
        chatEl.appendChild(block);
        chatEl.scrollTop = chatEl.scrollHeight;
    }

    function addThinking() {
        const id = 't-' + Date.now();
        const block = document.createElement('div');
        block.id = id;
        block.className = 'msg-block bot thinking';
        block.innerHTML = '<div class="bot-meta"><div class="avatar"></div><span style="color:var(--orange)">–°–ò–ù–¢–ï–ó...</span></div>';
        chatEl.appendChild(block);
        chatEl.scrollTop = chatEl.scrollHeight;
        return id;
    }

    sendBtn.onclick = sendMessage;
    inputEl.onkeypress = (e) => e.key === 'Enter' && sendMessage();

    window.onload = () => addMessage("–°–ò–°–¢–ï–ú–ê PLAZMA –ì–û–¢–û–í–ê. –ñ–î–£ –í–í–û–î–ê –î–ê–ù–ù–´–•.", "bot");
</script>

</body>
</html>
