<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PLAZMA AI</title>
    <style>
        :root {
            --dark: #0a0500;
            --lava: linear-gradient(90deg, #ff4e00, #ec9f05, #ff4e00);
            --orange: #ff6a00;
            --glow: 0 0 15px #ff4e00;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; }
        
        body { 
            background: var(--dark); 
            margin: 0; overflow: hidden; color: #fff;
            background-image: radial-gradient(circle at center, #1a0a00 0%, #0a0500 100%);
        }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω –ª–∞–≤—ã */
        .lava-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; opacity: 0.1;
            background: repeating-linear-gradient(45deg, #ff4e00 0%, #000 10%, #ec9f05 20%);
            background-size: 200% 200%;
            animation: flow 10s infinite linear;
        }
        @keyframes flow { 0% {background-position: 0 0;} 100% {background-position: 200% 200%;} }

        .app { height: 100vh; display: flex; flex-direction: column; max-width: 800px; margin: 0 auto; border: 1px solid #331a00; box-shadow: var(--glow); }

        .header { 
            padding: 20px; text-align: center; font-weight: bold; font-size: 24px;
            letter-spacing: 5px; background: rgba(0,0,0,0.8); border-bottom: 2px solid var(--orange);
            text-shadow: var(--glow); color: var(--orange);
        }

        .chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 25px; }

        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        .msg-wrapper { display: flex; flex-direction: column; position: relative; }
        .msg { 
            max-width: 85%; padding: 15px; border-radius: 15px; font-size: 16px; 
            line-height: 1.5; border: 1px solid transparent; transition: 0.3s;
        }

        .user { align-self: flex-end; background: rgba(50, 50, 50, 0.5); border-color: #444; color: #eee; }
        
        .bot { 
            align-self: flex-start; background: rgba(20, 10, 0, 0.8); 
            border-color: var(--orange); position: relative;
            background-clip: padding-box;
        }

        /* –õ–∞–≤–æ–≤—ã–π —Ç–µ–∫—Å—Ç –±–æ—Ç–∞ */
        .bot-text {
            background: var(--lava);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
            background-size: 200% auto;
            animation: textFlow 3s linear infinite;
        }
        @keyframes textFlow { to { background-position: 200% center; } }

        /* –ê–≤–∞—Ç–∞—Ä–∫–∞ Plazma */
        .avatar {
            width: 50px; height: 50px; border-radius: 50%;
            background: radial-gradient(circle, #ff9d00, #ff4e00, #000);
            border: 2px solid var(--orange); margin-top: 10px;
            box-shadow: var(--glow); align-self: flex-start;
            transition: 0.5s; position: relative;
        }
        .avatar.thinking {
            animation: pulse 0.5s infinite alternate, rotate 1s infinite linear;
            filter: brightness(1.5);
        }
        @keyframes pulse { from { transform: scale(1); box-shadow: 0 0 10px #ff4e00; } to { transform: scale(1.1); box-shadow: 0 0 30px #ffea00; } }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        .input-area { 
            padding: 20px; background: rgba(0,0,0,0.9); border-top: 2px solid var(--orange);
            display: flex; gap: 10px; align-items: center;
        }
        input { 
            flex: 1; background: #111; border: 1px solid var(--orange); border-radius: 25px;
            padding: 12px 20px; color: var(--orange); outline: none; transition: 0.3s;
        }
        input:focus { box-shadow: inset 0 0 10px var(--orange); }

        .btn {
            background: var(--orange); border: none; width: 45px; height: 45px;
            border-radius: 50%; cursor: pointer; color: #000; font-weight: bold;
            display: flex; align-items: center; justify-content: center; box-shadow: var(--glow);
        }
        .btn:hover { transform: scale(1.1); }
        .btn-mic.active { background: #ff0000; animation: pulse 0.6s infinite alternate; }

        pre { background: #000; padding: 10px; border-left: 3px solid var(--orange); overflow-x: auto; color: #ff9d00; }
    </style>
</head>
<body>

<div class="lava-bg"></div>

<div class="app">
    <div class="header">PLAZMA :: CORE</div>
    <div class="chat" id="chat"></div>
    
    <div class="input-area">
        <button id="micBtn" class="btn btn-mic">üé§</button>
        <input type="text" id="userInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è PLAZMA...">
        <button id="sendBtn" class="btn">üöÄ</button>
    </div>
</div>

<script>
    const chatEl = document.getElementById('chat');
    const inputEl = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const micBtn = document.getElementById('micBtn');

    const API_KEY = 'AIzaSyAPAPolrbv3TtYSO27MQG-bEMK0DxDE1Ns'; 
    const URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

    let history = [];
    let isThinking = false;

    // –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'ru-RU';
        
        micBtn.onclick = () => {
            recognition.start();
            micBtn.classList.add('active');
        };

        recognition.onresult = (event) => {
            inputEl.value = event.results[0][0].transcript;
            micBtn.classList.remove('active');
            sendMessage();
        };
        recognition.onend = () => micBtn.classList.remove('active');
    }

    // –ì–æ–ª–æ—Å–æ–≤–æ–π –≤—ã–≤–æ–¥
    function speak(text) {
        const msg = new SpeechSynthesisUtterance();
        msg.text = text;
        msg.lang = 'ru-RU';
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ "–º—É–∂—Å–∫–æ–≥–æ" –±–∞—Å–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —Å–∏—Å—Ç–µ–º–µ)
        const voices = window.speechSynthesis.getVoices();
        msg.voice = voices.find(v => v.name.includes('Microsoft Pavel')) || voices[0];
        msg.pitch = 0.5; 
        msg.rate = 0.9;
        window.speechSynthesis.speak(msg);
    }

    async function sendMessage() {
        const text = inputEl.value.trim();
        if (!text || isThinking) return;

        addMessage(text, 'user');
        inputEl.value = '';
        
        isThinking = true;
        const thinkingAvatar = createThinkingAvatar();

        history.push({ "role": "user", "parts": [{ "text": text }] });

        try {
            const response = await fetch(URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ "contents": history })
            });

            const data = await response.json();
            const botText = data.candidates[0].content.parts[0].text;

            thinkingAvatar.remove();
            addMessage(botText, 'bot');
            speak(botText);
            history.push({ "role": "model", "parts": [{ "text": botText }] });

        } catch (e) {
            thinkingAvatar.remove();
            addMessage("–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –Ø–î–†–ê. –ü–†–û–í–ï–†–¨–¢–ï VPN.", 'bot');
        } finally {
            isThinking = false;
        }
    }

    function addMessage(text, side) {
        const wrapper = document.createElement('div');
        wrapper.className = 'msg-wrapper';

        const div = document.createElement('div');
        div.className = `msg ${side}`;
        
        if (side === 'bot') {
            div.innerHTML = `<div class="bot-text">${text.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')}</div>`;
            wrapper.appendChild(div);
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            wrapper.appendChild(avatar);
        } else {
            div.innerText = text;
            wrapper.appendChild(div);
        }

        chatEl.appendChild(wrapper);
        chatEl.scrollTop = chatEl.scrollHeight;
    }

    function createThinkingAvatar() {
        const avatar = document.createElement('div');
        avatar.className = 'avatar thinking';
        chatEl.appendChild(avatar);
        chatEl.scrollTop = chatEl.scrollHeight;
        return avatar;
    }

    sendBtn.onclick = sendMessage;
    inputEl.onkeypress = (e) => { if (e.key === 'Enter') sendMessage(); };
    window.onload = () => addMessage("–Ø–î–†–û PLAZMA –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–û. –ñ–î–£ –ü–†–ò–ö–ê–ó–ê–ù–ò–ô.", "bot");
</script>
</body>
</html>
